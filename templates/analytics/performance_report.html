<!-- templates/analytics/performance_report.html -->
{% extends "core/base.html" %}
{% load static %}
{% load humanize %}
{% block title %}Performance Report{% endblock %}

{% block page_title %}Performance Report{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/performance_report.css' %}">

<!-- Page Subtitle -->
<div class="page-subtitle">
    <p>Hotel performance summary for {{ period|default:"the last 30 days" }}</p>
</div>

<!-- Metric Cards Grid -->
<div class="metrics-grid-extended">
    <!-- Total Revenue Card -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-icon-wrapper metric-icon-green">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"/>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
            </div>
            <span class="metric-label">Total Revenue</span>
        </div>
        <div class="metric-value">₦{{ revenue_30|intcomma|default:"0" }}</div>
        <div class="metric-change positive">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
            </svg>
            <span>Last 30 days</span>
        </div>
    </div>

    <!-- Total Reservations Card -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-icon-wrapper metric-icon-blue">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
            </div>
            <span class="metric-label">Total Reservations</span>
        </div>
        <div class="metric-value">{{ reservations_30|default:"0" }}</div>
        <div class="metric-subtitle">Bookings received</div>
    </div>

    <!-- Completed Check Outs Card -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-icon-wrapper metric-icon-purple">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"/>
                </svg>
            </div>
            <span class="metric-label">Completed Check Outs</span>
        </div>
        <div class="metric-value">{{ completed_30|default:"0" }}</div>
        <div class="metric-subtitle">Successfully checked out</div>
    </div>

    <!-- New Guests Card -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-icon-wrapper metric-icon-orange">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="8.5" cy="7" r="4"/>
                    <line x1="20" y1="8" x2="20" y2="14"/>
                    <line x1="23" y1="11" x2="17" y2="11"/>
                </svg>
            </div>
            <span class="metric-label">New Guests</span>
        </div>
        <div class="metric-value">{{ new_guests_30|default:"0" }}</div>
        <div class="metric-subtitle">First time visitors</div>
    </div>

    <!-- Average Occupancy Card -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-icon-wrapper metric-icon-teal">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
            </div>
            <span class="metric-label">Average Occupancy Rate</span>
        </div>
        <div class="metric-value">{{ avg_occupancy|default:"0" }}%</div>
        <div class="metric-subtitle">Overall performance</div>
    </div>
</div>

<!-- Performance Chart Section -->
<div class="performance-chart-card">
    <div class="chart-header">
        <h3 class="chart-title">30 Day Performance Overview</h3>
        <div class="chart-legend-horizontal">
            <div class="legend-item">
                <span class="legend-square" style="background-color: #10B981;"></span>
                <span class="legend-label">Revenue (₦)</span>
            </div>
            <div class="legend-item">
                <span class="legend-line" style="background-color: #3B82F6;"></span>
                <span class="legend-label">Reservations / Guests / Occupancy</span>
            </div>
        </div>
    </div>
    <div class="chart-body-large">
        <canvas id="performanceChart"></canvas>
    </div>
</div>

<!-- Performance Summary Cards -->
<div class="summary-cards-grid">
    <div class="summary-card">
        <div class="summary-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                <polyline points="17 6 23 6 23 12"/>
            </svg>
        </div>
        <div class="summary-content">
            <div class="summary-label">Revenue Growth</div>
            <div class="summary-value">+12.5%</div>
            <div class="summary-detail">Compared to previous period</div>
        </div>
    </div>

    <div class="summary-card">
        <div class="summary-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
            </svg>
        </div>
        <div class="summary-content">
            <div class="summary-label">Guest Satisfaction</div>
            <div class="summary-value">4.8/5.0</div>
            <div class="summary-detail">Based on recent reviews</div>
        </div>
    </div>

    <div class="summary-card">
        <div class="summary-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
            </svg>
        </div>
        <div class="summary-content">
            <div class="summary-label">Booking Velocity</div>
            <div class="summary-value">{{ reservations_30|default:"0" }}</div>
            <div class="summary-detail">Reservations this period</div>
        </div>
    </div>
</div>

<script>
const ctx = document.getElementById('performanceChart').getContext('2d');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: [
            'Revenue',
            'Reservations',
            'Completed Checkouts',
            'New Guests',
            'Avg Occupancy (%)'
        ],
        datasets: [
            {
                label: 'Revenue (₦)',
                data: [
                    {{ revenue_30|default:"0" }},
                    null,
                    null,
                    null,
                    null
                ],
                backgroundColor: '#10B981',
                borderRadius: 6,
                yAxisID: 'y',
                barPercentage: 0.6
            },
            {
                label: 'Counts and Occupancy',
                type: 'line',
                data: [
                    null,
                    {{ reservations_30|default:"0" }},
                    {{ completed_30|default:"0" }},
                    {{ new_guests_30|default:"0" }},
                    {{ avg_occupancy|default:"0" }}
                ],
                borderColor: '#3B82F6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                pointRadius: 5,
                pointHoverRadius: 7,
                pointBackgroundColor: '#3B82F6',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                yAxisID: 'y1',
                fill: true
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
            mode: 'index',
            intersect: false
        },
        plugins: {
            legend: {
                display: false
            },
            tooltip: {
                backgroundColor: '#1F2937',
                padding: 12,
                titleColor: '#F9FAFB',
                bodyColor: '#F9FAFB',
                borderColor: '#374151',
                borderWidth: 1,
                callbacks: {
                    label: function(context) {
                        let label = context.dataset.label || '';
                        if (label) {
                            label += ': ';
                        }
                        if (context.parsed.y !== null) {
                            if (context.datasetIndex === 0) {
                                label += '₦' + context.parsed.y.toLocaleString();
                            } else {
                                label += context.parsed.y.toLocaleString();
                            }
                        }
                        return label;
                    }
                }
            }
        },
        scales: {
            y: {
                type: 'linear',
                position: 'left',
                title: {
                    display: true,
                    text: 'Revenue (₦)',
                    font: {
                        size: 13,
                        weight: '600'
                    },
                    color: '#6B7280'
                },
                beginAtZero: true,
                grid: {
                    color: '#F3F4F6',
                    drawBorder: false
                },
                border: {
                    display: false
                },
                ticks: {
                    color: '#6B7280',
                    font: { size: 12 },
                    callback: function(value) {
                        return '₦' + (value / 1000) + 'K';
                    }
                }
            },
            y1: {
                type: 'linear',
                position: 'right',
                title: {
                    display: true,
                    text: 'Reservations / Guests / Occupancy',
                    font: {
                        size: 13,
                        weight: '600'
                    },
                    color: '#6B7280'
                },
                beginAtZero: true,
                grid: {
                    drawOnChartArea: false
                },
                border: {
                    display: false
                },
                ticks: {
                    color: '#6B7280',
                    font: { size: 12 }
                }
            },
            x: {
                grid: {
                    display: false
                },
                border: {
                    display: false
                },
                ticks: {
                    color: '#6B7280',
                    font: { size: 12 }
                }
            }
        }
    }
});
</script>
{% endblock %}