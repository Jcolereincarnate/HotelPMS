<!-- templates/core/analytics_dashboard.html -->
{% extends "core/base.html" %}
{% block title %}Analytics Dashboard{% endblock %}
{% load humanize %}
{% load static %}

{% block page_title %}Analytics Dashboard{% endblock %}

{% block content %}
<!-- Metric Cards Grid -->
<div class="metrics-grid">
    <!-- Occupancy Rate Card -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-icon-wrapper metric-icon-blue">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
            </div>
            <span class="metric-label">Occupancy Rate</span>
        </div>
        <div class="metric-value">{{ occupancy_rate|default:"0" }}%</div>
        <div class="metric-subtitle">{{ occupied_rooms|default:"0" }}/{{ total_rooms|default:"0" }} rooms occupied</div>
    </div>

    <!-- Revenue Card -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-icon-wrapper metric-icon-green">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"/>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
            </div>
            <span class="metric-label">Revenue (30 Days)</span>
        </div>
        <div class="metric-value">₦{{ total_revenue|floatformat:0|intcomma|default:"0" }}</div>
        <div class="metric-subtitle">Avg: ₦{{ avg_revenue|floatformat:0|intcomma|default:"0" }}/day</div>
    </div>

    <!-- Total Guests Card -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-icon-wrapper metric-icon-orange">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
            </div>
            <span class="metric-label">Total Guests</span>
        </div>
        <div class="metric-value">{{ total_guests|default:"0" }}</div>
        <div class="metric-subtitle">{{ vip_guests|default:"0" }} VIP • {{ repeat_guests|default:"0" }} Repeat</div>
    </div>

    <!-- Reservations Card -->
    <div class="metric-card">
        <div class="metric-header">
            <div class="metric-icon-wrapper metric-icon-purple">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
            </div>
            <span class="metric-label">Reservations</span>
        </div>
        <div class="metric-value">{{ total_reservations|default:"0" }}</div>
        <div class="metric-subtitle">{{ confirmed_reservations|default:"0" }} upcoming</div>
    </div>
</div>

<!-- Charts and Insights Section -->
<div class="analytics-grid">
    <!-- Revenue Trend Chart -->
    <div class="chart-card chart-card-large">
        <div class="chart-header">
            <h3 class="chart-title">Revenue Trend (30 Days)</h3>
            <div class="chart-legend">
                <div class="legend-item">
                    <span class="legend-dot legend-dot-green"></span>
                    <span class="legend-label">Daily Revenue</span>
                </div>
            </div>
        </div>
        <div class="chart-body">
            <canvas id="revenueTrendChart"></canvas>
        </div>
    </div>

    <!-- 30-Day Summary Card -->
    <div class="summary-card">
        <h3 class="summary-title">30-Day Summary</h3>
        {% if daily_metrics %}
        <div class="summary-metrics">
            <div class="summary-item">
                <div class="summary-label">Avg Occupancy</div>
                <div class="summary-value">{{ daily_metrics.avg_occupancy|floatformat:1|default:"0" }}%</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">Avg Daily Guests</div>
                <div class="summary-value">{{ daily_metrics.avg_guests|floatformat:0|default:"0" }}</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">Total Revenue</div>
                <div class="summary-value summary-value-highlight">₦{{ total_revenue|floatformat:0|intcomma|default:"0" }}</div>
            </div>
        </div>
        {% else %}
        <div class="empty-state">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <line x1="18" y1="20" x2="18" y2="10"/>
                <line x1="12" y1="20" x2="12" y2="4"/>
                <line x1="6" y1="20" x2="6" y2="14"/>
            </svg>
            <p>No metrics available</p>
        </div>
        {% endif %}
    </div>

    <!-- Occupancy Distribution -->
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Occupancy Distribution</h3>
        </div>
        <div class="chart-body">
            <canvas id="occupancyDistChart"></canvas>
        </div>
    </div>

    <!-- Guest Type Breakdown -->
    <div class="chart-card">
        <div class="chart-header">
            <h3 class="chart-title">Guest Categories</h3>
        </div>
        <div class="demographics-list">
            <div class="demographic-item">
                <div class="demographic-info">
                    <span class="demographic-color" style="background-color: #10B981;"></span>
                    <span class="demographic-label">Regular Guests</span>
                </div>
                <span class="demographic-value">{{ total_guests|default:"0" }}</span>
            </div>
            <div class="demographic-item">
                <div class="demographic-info">
                    <span class="demographic-color" style="background-color: #F59E0B;"></span>
                    <span class="demographic-label">VIP Guests</span>
                </div>
                <span class="demographic-value">{{ vip_guests|default:"0" }}</span>
            </div>
            <div class="demographic-item">
                <div class="demographic-info">
                    <span class="demographic-color" style="background-color: #3B82F6;"></span>
                    <span class="demographic-label">Repeat Guests</span>
                </div>
                <span class="demographic-value">{{ repeat_guests|default:"0" }}</span>
            </div>
        </div>
    </div>
</div>

<!-- Quick Links Section -->
<div class="quick-actions-card">
    <div class="quick-actions-header">
        <h3 class="quick-actions-title">Quick Links & Reports</h3>
        <a href="{% url 'ai_recommendations' %}" class="btn-ai-recommendations">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4"/>
                <path d="M12 8h.01"/>
            </svg>
            AI Recommendations
        </a>
    </div>
    <div class="quick-actions-grid">
        <a href="{% url 'occupancy_analytics' %}" class="quick-action-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            </svg>
            <span>Occupancy Analytics</span>
        </a>
        <a href="{% url 'revenue_analytics' %}" class="quick-action-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
            <span>Revenue Analytics</span>
        </a>
        <a href="{% url 'guest_insights' %}" class="quick-action-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
            </svg>
            <span>Guest Insights</span>
        </a>
        <a href="{% url 'performance_report' %}" class="quick-action-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
            </svg>
            <span>Performance Report</span>
        </a>
    </div>
</div>

<script>
// Revenue Trend Chart
const revenueTrendCtx = document.getElementById('revenueTrendChart').getContext('2d');
const revenueTrendChart = new Chart(revenueTrendCtx, {
    type: 'line',
    data: {
        labels: ['Day 1', 'Day 5', 'Day 10', 'Day 15', 'Day 20', 'Day 25', 'Day 30'],
        datasets: [{
            label: 'Daily Revenue',
            data: [45000, 52000, 48000, 61000, 55000, 67000, 58000],
            borderColor: '#10B981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 4,
            pointHoverRadius: 6,
            pointBackgroundColor: '#10B981',
            pointBorderColor: '#fff',
            pointBorderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            },
            tooltip: {
                backgroundColor: '#1F2937',
                padding: 12,
                titleColor: '#F9FAFB',
                bodyColor: '#F9FAFB',
                borderColor: '#374151',
                borderWidth: 1,
                callbacks: {
                    label: function(context) {
                        return 'Revenue: ₦' + context.parsed.y.toLocaleString();
                    }
                }
            }
        },
        scales: {
            x: {
                grid: {
                    display: false
                },
                border: {
                    display: false
                },
                ticks: {
                    color: '#6B7280',
                    font: {
                        size: 12
                    }
                }
            },
            y: {
                beginAtZero: true,
                grid: {
                    color: '#F3F4F6',
                    drawBorder: false
                },
                border: {
                    display: false
                },
                ticks: {
                    color: '#6B7280',
                    font: {
                        size: 12
                    },
                    callback: function(value) {
                        return '₦' + (value / 1000) + 'K';
                    }
                }
            }
        }
    }
});

// Occupancy Distribution Chart
const occupancyDistCtx = document.getElementById('occupancyDistChart').getContext('2d');
const occupancyDistChart = new Chart(occupancyDistCtx, {
    type: 'doughnut',
    data: {
        labels: ['Occupied', 'Available', 'Maintenance'],
        datasets: [{
            data: [{{ occupied_rooms|default:"45" }}, {{ total_rooms|default:"100"|add:"-45" }}, 5],
            backgroundColor: ['#10B981', '#E5E7EB', '#F59E0B'],
            borderWidth: 0,
            spacing: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    usePointStyle: true,
                    padding: 15,
                    font: {
                        size: 12
                    },
                    color: '#6B7280'
                }
            },
            tooltip: {
                backgroundColor: '#1F2937',
                padding: 12,
                titleColor: '#F9FAFB',
                bodyColor: '#F9FAFB',
                borderColor: '#374151',
                borderWidth: 1
            }
        },
        cutout: '65%'
    }
});
</script>
{% endblock %}